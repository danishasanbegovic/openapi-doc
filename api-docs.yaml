openapi: 3.0.3
info:
  title: Danis API
  version: v1.0
  description: |
    REST API for managing employees, departments, and time tracking.
servers:
  - url: http://localhost:8080
    description: Local development server

paths:
  /auth/register:
    post:
      tags: [auth-controller]
      summary: Register a new user
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "202":
          description: Registration accepted and verification email sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistrationResponse"

  /auth/verify-email:
    post:
      tags: [auth-controller]
      summary: Verify email with a 6 digit code
      operationId: verifyEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmailVerificationRequest"
      responses:
        "200":
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"

        "400":
          description: Invalid or expired verification code
          
  /auth/resend-verification:
    post:
      tags: [auth-controller]
      summary: Resend verification code to an unverified email
      operationId: resendVerificationEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResendVerificationRequest"
      responses:
        "202":
          description: Verification code resent and expiry refreshed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistrationResponse"
        "404":
          description: Account with the provided email was not found
        "409":
          description: Email is already verified

  /auth/login:
    post:
      tags: [auth-controller]
      summary: Log in and receive a JWT token
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
  /mitarbeiter:
    get:
      tags: [mitarbeiter-controller]
      summary: Get all employees
      operationId: getAllMitarbeiter
      responses:
        "200":
          description: List of employees
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MitarbeiterDto"
    post:
      tags: [mitarbeiter-controller]
      summary: Add a new employee
      operationId: addMitarbeiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MitarbeiterDto"
      responses:
        "200":
          description: Employee created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MitarbeiterDto"

  /mitarbeiter/{id}:
    put:
      tags: [mitarbeiter-controller]
      summary: Update an existing employee
      operationId: updateMitarbeiter
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MitarbeiterDto"
      responses:
        "200":
          description: Updated employee
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MitarbeiterDto"
    delete:
      tags: [mitarbeiter-controller]
      summary: Delete an employee
      operationId: deleteMitarbeiter
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Employee deleted

  /abteilungen:
    get:
      tags: [abteilung-controller]
      summary: Get all departments
      operationId: getAllAbteilungen
      responses:
        "200":
          description: List of departments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AbteilungDto"
    post:
      tags: [abteilung-controller]
      summary: Add a new department
      operationId: addAbteilung
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AbteilungDto"
      responses:
        "200":
          description: Department created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AbteilungDto"

  /abteilungen/{id}:
    put:
      tags: [abteilung-controller]
      summary: Update an existing department
      operationId: updateAbteilung
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AbteilungDto"
      responses:
        "200":
          description: Updated department
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AbteilungDto"
    delete:
      tags: [abteilung-controller]
      summary: Delete a department
      operationId: deleteAbteilung
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Department deleted

  /abteilungen/stunden/{id}:
    get:
      tags: [abteilung-controller]
      summary: Get all hours for a department
      operationId: getAbteilungStunden
      parameters:
        - name: id
          in: path
          required: true
          description: Department ID
          schema:
            type: integer
            format: int32
      responses:
        "200":
          description: List of hours for this department
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AbteilungStundenDto"

  /abteilungen/stunden/{abteilungid}/{pspid}:
    get:
      tags: [abteilung-controller]
      summary: Calculate total hours for a specific PSP within a department
      operationId: calculateStundenperPsp
      parameters:
        - name: abteilungid
          in: path
          required: true
          schema:
            type: integer
        - name: pspid
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Total hours
          content:
            application/json:
              schema:
                type: number
                format: double

  /get-stunden:
    get:
      tags: [stunden-controller]
      summary: Get all logged hours
      operationId: getStunden
      responses:
        "200":
          description: List of all time statistics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ZeitStatistikDto"

  /stunden:
    get:
      tags: [stunden-controller]
      summary: Get detailed logged hours
      operationId: getRecordedStunden
      responses:
        "200":
          description: List of all recorded hours with details
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ZeiterfassungDto"

  /get-psp:
    get:
      tags: [stunden-controller]
      summary: Get all PSP entities
      operationId: findAll
      responses:
        "200":
          description: List of PSPs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PspDto"

  /add-stunden:
    post:
      tags: [stunden-controller]
      summary: Add working hours for a PSP and employee
      operationId: addStunden
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ZeiterfassungCreateRequest"
      responses:
        "200":
          description: Hours recorded successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ZeiterfassungDto"

  /stunden/{id}:
    get:
      tags: [ stunden-controller ]
      summary: Get a single recorded hour entry
      operationId: getRecordedStundenById
      parameters:
        - name: id
          in: path
          required: true
          description: Zeiterfassung identifier
          schema:
            type: integer
            format: int32
      responses:
        "200":
          description: Requested recorded hours entry
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ZeiterfassungDto"
        "404":
          description: Hours entry not found
    put:
      tags: [stunden-controller]
      summary: Update recorded hours
      operationId: updateStunden
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ZeiterfassungCreateRequest"
      responses:
        "200":
          description: Updated hours entry
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ZeiterfassungDto"
        "404":
          description: Hours entry not found
    delete:
      tags: [stunden-controller]
      summary: Delete recorded hours
      operationId: deleteStunden
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Hours entry deleted
        "404":
          description: Hours entry not found
  /overtime/policies:
    get:
      tags: [overtime]
      summary: List overtime policies
      responses:
        "200":
          description: Policies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OvertimePolicy"
    post:
      tags: [overtime]
      summary: Create or update overtime policy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OvertimePolicy"
      responses:
        "200":
          description: Stored policy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OvertimePolicy"

  /overtime/entries/{id}/approval:
    post:
      tags: [overtime]
      summary: Approve or reject overtime entries
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApprovalDecisionRequest"
      responses:
        "200":
          description: Entry updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ZeiterfassungDto"
        "404":
          description: Entry not found

  /overtime/analytics/employees:
    get:
      tags: [overtime]
      summary: Employee overtime analytics
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date
        - in: query
          name: end
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: size
          schema:
            type: integer
      responses:
        "200":
          description: Analytics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OvertimeAnalyticsDto"

  /overtime/analytics/departments:
    get:
      tags: [overtime]
      summary: Department overtime analytics
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date
        - in: query
          name: end
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: size
          schema:
            type: integer
      responses:
        "200":
          description: Analytics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OvertimeAnalyticsDto"

  /overtime/approvals:
    get:
      tags: [overtime]
      summary: List overtime approvals
      responses:
        "200":
          description: Approvals
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ApprovalDecisionRequest"


components:
  schemas:
    AbteilungDto:
      type: object
      properties:
        abteilungID:
          type: integer
        name:
          type: string
        budget:
          type: number
          format: double
        standort:
          type: string

    MitarbeiterDto:
      type: object
      properties:
        mitarbeiterID:
          type: integer
        name:
          type: string
        nachname:
          type: string
        email:
          type: string
          format: email
        position:
          type: string
          enum: [Chef, Angestellt, Freelancer, Azubi]
        abteilung:
          $ref: "#/components/schemas/AbteilungDto"
        password:
          type: string

    RegisterRequest:
      type: object
      required: [name, nachname, email, password, position]
      properties:
        name:
          type: string
        nachname:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        abteilungId:
          type: integer
        position:
          type: string
          enum: [Chef, Angestellt, Freelancer, Azubi]

    RegistrationResponse:
      type: object
      required: [message, verificationRequired]
      properties:
        message:
          type: string
        verificationRequired:
          type: boolean

    EmailVerificationRequest:
      type: object
      required: [email, code]
      properties:
        email:
          type: string
          format: email
        code:
          type: string
          pattern: "^[0-9]{6}$"

    ResendVerificationRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string

    AuthResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token for authentication

    AbteilungStundenDto:
      type: object
      properties:
        abteilungid:
          type: integer
        pspElement:
          $ref: "#/components/schemas/PspDto"
        stunden:
          type: number
          format: double

    PspDto:
      type: object
      properties:
        id:
          type: integer
        beschreibung:
          type: string

    ZeiterfassungCreateRequest:
      type: object
      properties:
        id:
          type: object
        mitarbeiterId:
          type: integer
        datum:
          type: string
          format: date
        startzeit:
          type: string
          format: time
        endzeit:
          type: string
          format: time

    ZeiterfassungDto:
      type: object
      properties:
        id:
          type: integer
        datum:
          type: string
          format: date
        startzeit:
          type: string
          format: time
        endzeit:
          type: string
          format: time
        mitarbeiter:
          $ref: "#/components/schemas/MitarbeiterDto"
        psp:
          $ref: "#/components/schemas/PspDto"
        workedHours:
          type: number
          format: double
        overtimeHours:
          type: number
          format: double
        approvalStatus:
          type: string
          enum: [NONE, PENDING, APPROVED, REJECTED]
        violation:
          type: boolean
        violationCode:
          type: string
        violationMessage:
          type: string

    ZeitStatistikDto:
      type: object
      properties:
        id:
          $ref: "#/components/schemas/ZeitStatistikId"

    ZeitStatistikId:
      type: object
      properties:
        mitarbeiterid:
          type: integer
        pspid:
          type: integer
        stunden:
          type: number
          format: double

    OvertimePolicy:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        abteilungId:
          type: integer
        dailyLimitHours:
          type: number
          format: double
        weeklyLimitHours:
          type: number
          format: double
        maxHoursPerDay:
          type: number
          format: double
        minRestHours:
          type: number
          format: double
        effectiveFrom:
          type: string
          format: date
        effectiveTo:
          type: string
          format: date
        defaultPolicy:
          type: boolean

    ApprovalDecisionRequest:
      type: object
      properties:
        status:
          type: string
          enum: [PENDING, APPROVED, REJECTED]
        managerComment:
          type: string

    OvertimeAnalyticsDto:
      type: object
      properties:
        targetId:
          type: integer
        targetType:
          type: string
        totalOvertime:
          type: number
          format: double
        violations:
          type: integer

